{
  "version": "1.0",
  "project": {
    "name": "samuel",
    "description": "Autonomous pilot mode - AI-discovered tasks",
    "created_at": "2026-02-21T21:55:56Z",
    "updated_at": "2026-02-22T06:30:00Z"
  },
  "config": {
    "max_iterations": 30,
    "quality_checks": [
      "go test ./...",
      "go vet ./...",
      "go build ./..."
    ],
    "ai_tool": "claude",
    "ai_prompt_file": ".claude/auto/prompt.md",
    "sandbox": "none",
    "pilot_mode": true,
    "pilot_config": {
      "discover_interval": 5,
      "max_discovery_tasks": 10
    },
    "discovery_prompt_file": ".claude/auto/discovery-prompt.md"
  },
  "tasks": [
    {
      "id": "61",
      "title": "Fix unchecked file.Close() errors after io.Copy in downloader.go and extractor.go",
      "description": "downloader.go lines 168, 171, 255 and extractor.go line 415 call file.Close() or defer dst.Close() without checking the error after io.Copy writes. On some filesystems, Close() is when buffered data is flushed to disk. A failed Close() means silently corrupted extracted files. Fix by checking Close() error and returning it (for non-deferred) or using a named return + deferred error check pattern.",
      "status": "completed",
      "priority": "high",
      "complexity": "medium",
      "files_to_modify": [
        "internal/core/downloader.go",
        "internal/core/extractor.go"
      ],
      "commit_sha": "a53222d",
      "source": "pilot-discovery"
    },
    {
      "id": "62",
      "title": "Add Docker sandbox image name validation in auto_loop.go",
      "description": "SandboxImage from prd.json (user-editable) is passed directly to docker run without validation (auto_loop.go:146). A tampered prd.json could specify a malicious Docker image. Add an IsValidSandboxImage() function that validates image names match a safe pattern (e.g., alphanumeric with dots, dashes, colons, slashes for registry/image:tag format) and rejects shell metacharacters or absolute paths.",
      "status": "completed",
      "priority": "medium",
      "complexity": "low",
      "files_to_modify": [
        "internal/core/auto_loop.go",
        "internal/core/docker.go"
      ],
      "commit_sha": "8f60188",
      "source": "pilot-discovery"
    },
    {
      "id": "63",
      "title": "Add unit tests for doctor_checks.go check functions",
      "description": "doctor_checks.go (291 LOC) was created by the task 6 refactor of runDoctor() but has 0% test coverage. Contains 8 exported check functions (checkConfigFile, checkCLAUDEMD, checkAGENTSMD, checkDirectoryStructure, checkInstalledComponents, checkSkillsIntegrity, checkAutoHealth, checkLocalModifications) plus the generic checkInstalledSkills helper. Use t.TempDir() with crafted project directory structures to test each check function independently.",
      "status": "completed",
      "priority": "medium",
      "complexity": "high",
      "files_to_modify": [
        "internal/commands/doctor_checks_test.go"
      ],
      "commit_sha": "5782ea2",
      "source": "pilot-discovery"
    },
    {
      "id": "64",
      "title": "Add unit tests for init_steps.go step functions",
      "description": "init_steps.go (284 LOC) was created by the task 7 refactor of runInit() but has 0% test coverage. Contains testable functions: parseInitFlags (struct extraction from cobra command), validateInitTarget (directory validation), downloadFramework (delegates to downloader). Focus on parseInitFlags and validateInitTarget which are pure-ish functions testable without mocking.",
      "status": "completed",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/init_steps_test.go"
      ],
      "commit_sha": "7a9c814",
      "source": "pilot-discovery"
    },
    {
      "id": "65",
      "title": "Add unit tests for commands/update.go helper logic",
      "description": "update.go (264 LOC) has 0% test coverage and contains the largest function in the codebase (runUpdate at 219 lines). While runUpdate itself is hard to unit test (orchestration), look for extractable pure functions or test the file comparison logic. At minimum, test the string-to-bytes comparison pattern and the file categorization logic.",
      "status": "completed",
      "priority": "medium",
      "complexity": "high",
      "files_to_modify": [
        "internal/commands/update.go",
        "internal/commands/update_test.go"
      ],
      "commit_sha": "690365a",
      "source": "pilot-discovery"
    },
    {
      "id": "66",
      "title": "Refactor runSkillInfo() in commands/skill.go below 50-line limit",
      "description": "runSkillInfo() is 92 lines (1.84x the 50-line limit) at skill.go:284. Extract helper functions for: (1) skill lookup and SKILL.md path resolution, (2) metadata display formatting, (3) file preview rendering. This also helps reduce skill.go (375 lines) closer to the 300-line file limit.",
      "status": "completed",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/skill.go"
      ],
      "commit_sha": "3a077ad",
      "source": "pilot-discovery"
    },
    {
      "id": "67",
      "title": "Refactor runAutoStart() in auto_start_handler.go below 50-line limit",
      "description": "runAutoStart() is 80 lines (1.6x the 50-line limit) at auto_start_handler.go:12. Extract helper functions for: (1) flag parsing and config population, (2) PRD loading and validation, (3) loop configuration assembly. The function mixes flag parsing, PRD loading, config building, and loop invocation which should be separated.",
      "status": "pending",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/auto_start_handler.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "68",
      "title": "Add URL scheme validation for registry config value in config_cmd.go",
      "description": "The 'config set registry' command accepts any string without URL format validation (config_cmd.go:162-175). A malicious or accidental registry URL (e.g., http:// instead of https://, or a non-URL string) could redirect future downloads to untrusted sources. Add validation that the registry value is a valid HTTPS URL when the key is 'registry'.",
      "status": "pending",
      "priority": "medium",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/config_cmd.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "69",
      "title": "Replace deprecated filepath.Walk with filepath.WalkDir in core package",
      "description": "8 uses of deprecated filepath.Walk remain in the codebase (6 in extractor.go, 2 in downloader.go). filepath.WalkDir (available since Go 1.16) is more efficient because it provides fs.DirEntry instead of os.FileInfo, avoiding unnecessary Lstat calls. Replace all 8 uses in the core package, updating callback signatures from (path string, info os.FileInfo, err error) to (path string, d fs.DirEntry, err error). Call d.Info() only where FileInfo fields are actually needed.",
      "status": "pending",
      "priority": "low",
      "complexity": "medium",
      "files_to_modify": [
        "internal/core/extractor.go",
        "internal/core/downloader.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "70",
      "title": "Extract magic numbers to named constants in skill.go and ui/prompts.go",
      "description": "Several magic numbers should be named constants for clarity: skill.go:281-282 uses 80/77 for description truncation, prompts.go:30 uses 10 for prompt list size, prompts.go:92 uses 12 for multi-select list size, spinner.go:25 uses 14 for spinner type, spinner.go:85 uses 40 for progress bar width. Extract each to a descriptively named package-level constant.",
      "status": "pending",
      "priority": "low",
      "complexity": "low",
      "files_to_modify": [
        "internal/core/skill.go",
        "internal/ui/prompts.go",
        "internal/ui/spinner.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "71",
      "title": "Fix silently discarded LoadConfig errors in info.go and list.go",
      "description": "info.go:62 and list.go:122 both use `config, _ := core.LoadConfig()` discarding errors. Permission denied, corrupt YAML, or I/O errors are silently swallowed. Add error checking: for non-os.ErrNotExist errors, log via ui.Warn (matching the pattern established in search.go task 1). Missing config (ErrNotExist) is expected and should remain silent.",
      "status": "completed",
      "priority": "high",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/info.go",
        "internal/commands/list.go"
      ],
      "commit_sha": "8550e2c",
      "source": "pilot-discovery"
    },
    {
      "id": "72",
      "title": "Add unit tests for commands/skill.go skill management functions",
      "description": "skill.go (375 LOC) has 0% test coverage and is the largest untested command file. Contains 4 command handlers: runSkillCreate (input validation + scaffold), runSkillValidate (directory scanning + validation), runSkillList (listing + formatting), runSkillInfo (lookup + display). Focus on testable paths: validation error display, missing skills directory handling, empty skills list. Use t.TempDir() with crafted .claude/skills/ structures.",
      "status": "completed",
      "priority": "high",
      "complexity": "high",
      "files_to_modify": [
        "internal/commands/skill_test.go"
      ],
      "commit_sha": "1875291",
      "source": "pilot-discovery"
    },
    {
      "id": "73",
      "title": "Fix silently discarded os.RemoveAll error in downloader.go dev cache clear",
      "description": "downloader.go:49 calls `os.RemoveAll(cacheDest)` when clearing dev branch cache but discards the error. A failed removal followed by a new download could produce a corrupted mixed state (old + new files). Check the error and return it with context: `if err := os.RemoveAll(cacheDest); err != nil { return fmt.Errorf(\"failed to clear dev cache: %w\", err) }`.",
      "status": "pending",
      "priority": "medium",
      "complexity": "low",
      "files_to_modify": [
        "internal/core/downloader.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "74",
      "title": "Fix silently discarded ReadFile errors in update.go file comparison",
      "description": "update.go:147-155 has two os.ReadFile calls that silently `continue` on error. Permission denied or I/O errors cause files to be treated as 'unchanged' and silently skipped during update. Instead, log a warning via ui.Warn when ReadFile fails on either the local or cache copy, so users know a file was skipped and why.",
      "status": "pending",
      "priority": "medium",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/update.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "75",
      "title": "Fix silently discarded filepath.Rel error in sync.go SyncFolderCLAUDEMDs",
      "description": "sync.go:221 uses `rel, _ := filepath.Rel(opts.RootDir, path)` discarding the error. If filepath.Rel fails (e.g., paths on different volumes on Windows), `rel` would be empty, causing incorrect relative path construction for folder CLAUDE.md generation. Check the error and skip the directory with a ui.Warn log.",
      "status": "pending",
      "priority": "medium",
      "complexity": "low",
      "files_to_modify": [
        "internal/core/sync.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "76",
      "title": "Add unit tests for commands/list.go helper functions",
      "description": "list.go (164 LOC) has 0% test coverage. Contains listInstalled (73 lines) and listAvailable (69 lines) which format component listings. Test the formatting/display logic by setting up samuel.yaml configs with various component combinations (languages only, frameworks only, workflows, mixed). Verify output includes expected component names and categories.",
      "status": "pending",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/list_test.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "77",
      "title": "Add unit tests for commands/config_cmd.go pure functions",
      "description": "config_cmd.go (216 LOC) has only 62 lines of tests (3 cases). Contains testable pure functions: formatConfigValue (formats values for display), isValidConfigKey (validates against allowed keys). Add table-driven tests for both functions covering: valid keys (version, registry, owner, repo), invalid keys, empty/special characters, and formatConfigValue with various types.",
      "status": "pending",
      "priority": "medium",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/config_cmd_test.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "78",
      "title": "Refactor runUpdate() in commands/update.go below 50-line limit",
      "description": "runUpdate() is 219 lines (4.4x the 50-line limit) — the largest function in the codebase. Extract helper functions for: (1) resolveUpdateVersion (version checking + download), (2) categorizeFileChanges (file comparison loop producing new/modified/unchanged lists), (3) displayUpdateSummary (formatting change report), (4) applyUpdate (backup + extraction). This also helps reduce update.go (264 lines) below the 300-line file limit.",
      "status": "pending",
      "priority": "medium",
      "complexity": "high",
      "files_to_modify": [
        "internal/commands/update.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "79",
      "title": "Use bytes.Equal instead of string conversion for file comparison in update.go",
      "description": "update.go:157 uses `string(localContent) != string(cacheContent)` which allocates two string copies of the file contents for comparison. Replace with `!bytes.Equal(localContent, cacheContent)` which performs the same comparison with zero allocations. Add `bytes` import. This is a minor performance improvement but also a code clarity win.",
      "status": "pending",
      "priority": "low",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/update.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "80",
      "title": "Consolidate path containment validation into shared core utility",
      "description": "Three nearly identical path containment validation functions exist: validateContainedPath (extractor.go:204), validateRemovePath (remove.go:141), and validateSymlinkTarget (downloader.go:196). Export ValidateContainedPath from the core package and replace the duplicates. validateSymlinkTarget has slightly different logic (resolves relative to symlink parent dir) — keep as a wrapper that calls the shared function after resolving the target.",
      "status": "pending",
      "priority": "low",
      "complexity": "medium",
      "files_to_modify": [
        "internal/core/extractor.go",
        "internal/core/downloader.go",
        "internal/commands/remove.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "81",
      "title": "Add unit tests for auto_task_handlers.go task management functions",
      "description": "auto_task_handlers.go (127 LOC) has 0% test coverage and contains the task management CLI handlers used by `samuel auto task` subcommands. Contains testable functions: taskStatusIcon (pure mapping function: pending/in_progress/completed/skipped → emoji), updateTaskStatus (loads PRD, updates task, saves), runAutoTaskAdd (validates args, adds task to PRD). Use t.TempDir() with crafted prd.json files. Table-driven tests for taskStatusIcon covering all status values + unknown status.",
      "status": "pending",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/auto_task_handlers_test.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "82",
      "title": "Refactor runAdd() in commands/add.go below 50-line limit",
      "description": "runAdd() is 97 lines (1.94x the 50-line limit) at add.go:34. Mixes component type validation, duplicate checking, download orchestration, extraction, and config update in a single function. Extract helper functions for: (1) resolveComponent (type alias resolution + registry lookup + duplicate check), (2) downloadAndExtract (version resolution + download + extraction), (3) updateAddConfig (config loading + component addition + save). Each extracted function should be independently testable.",
      "status": "pending",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/add.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "83",
      "title": "Add unit tests for commands/add.go component addition logic",
      "description": "add.go (130 LOC) has 0% test coverage. After task 82 refactors runAdd() into smaller functions, test the extracted helpers: resolveComponent (valid/invalid type aliases, unknown component, already-installed component), updateAddConfig (config loading failures, successful addition). Use t.TempDir() with crafted samuel.yaml configs. The download path is hard to unit test without mocking, so focus on validation and config logic.",
      "status": "pending",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/add_test.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "84",
      "title": "Refactor executePilotLoop() in auto_pilot.go below 50-line limit",
      "description": "executePilotLoop() is 100 lines (2x the 50-line limit) at auto_pilot.go:146. Contains the main pilot loop with interleaved discovery and implementation logic, state tracking (lastDiscoveryIter, emptyDiscoveries, consecutiveFailures), and reload operations. Extract: (1) runDiscoveryPhase (discovery iteration + PRD reload + empty discovery tracking, ~25 lines), (2) runImplementationPhase (task selection + implementation iteration + failure tracking, ~20 lines). Keep the main loop orchestration in executePilotLoop at ~40 lines.",
      "status": "pending",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/auto_pilot.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "85",
      "title": "Add unit tests for auto_pilot.go flag parsing functions",
      "description": "auto_pilot.go (296 LOC) has 0% test coverage for its pure functions. parsePilotFlags (line 102) extracts cobra flags into a struct — testable with a fresh cobra.Command. parseAutoFlags (line 118) validates AITool and sandbox mode — testable with crafted flag values. Test cases: default flag values, invalid AI tool rejection, valid sandbox modes (none/docker/docker-sandbox), invalid sandbox rejection. Use the same cobra.Command helper pattern from init_steps_test.go.",
      "status": "pending",
      "priority": "medium",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/auto_pilot_test.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "86",
      "title": "Refactor runVersion() in commands/version.go below 50-line limit",
      "description": "runVersion() is 71 lines (1.42x the 50-line limit) at version.go:28. Mixes CLI version display, framework version reading from config, and update checking in a single function. Extract: (1) displayFrameworkVersion (config loading + version display, ~15 lines), (2) checkAndDisplayUpdates (downloader creation + update check + result formatting, ~20 lines). The main runVersion becomes a ~30 line orchestrator.",
      "status": "pending",
      "priority": "low",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/version.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "87",
      "title": "Add unit tests for commands/version.go version display logic",
      "description": "version.go (98 LOC) has 0% test coverage. After task 86 refactors runVersion(), test the extracted helpers: displayFrameworkVersion (no config → graceful, valid config → version shown), checkAndDisplayUpdates (--check flag behavior). The core runVersion early paths are testable: missing config (graceful degradation), config with version. Use t.TempDir() with crafted samuel.yaml. The update check path requires NewDownloader which hits github — focus on the non-network paths.",
      "status": "pending",
      "priority": "low",
      "complexity": "medium",
      "files_to_modify": [
        "internal/commands/version_test.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "88",
      "title": "Add unit tests for commands/sync.go relPath helper and runSync error paths",
      "description": "sync.go (113 LOC) has 0% test coverage. Contains relPath() pure helper (line 107) that falls back to absolute path on filepath.Rel failure — ideal for table-driven tests. Also test runSync early error paths: missing config file, invalid root directory, --dry-run flag. Use t.TempDir() with crafted samuel.yaml + .claude directory structure. The core sync logic delegates to core.SyncFolderCLAUDEMDs which is tested in sync_test.go.",
      "status": "pending",
      "priority": "low",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/sync_test.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "89",
      "title": "Add unit tests for auto_pilot_output.go display functions",
      "description": "auto_pilot_output.go (73 LOC) has 0% test coverage. Contains printPilotDryRun (displays pilot config without executing) and printPilotSummary (shows post-loop statistics). Both are display-only functions that read PRD state and format output. Test printPilotDryRun with various LoopConfig combinations (pilot mode on/off, different iteration counts, quality checks). Test printPilotSummary with crafted auto.PRD structs (various task status distributions). Use stdout capture pattern from output_test.go.",
      "status": "pending",
      "priority": "low",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/auto_pilot_output_test.go"
      ],
      "source": "pilot-discovery"
    },
    {
      "id": "90",
      "title": "Refactor runSync() in commands/sync.go below 50-line limit",
      "description": "runSync() is 67 lines (1.34x the 50-line limit) at sync.go:38. Mixes config loading, option assembly, sync execution, and result display in a single function. Extract: (1) displaySyncResults (iterates over results and formats each folder CLAUDE.md status, ~20 lines). This brings runSync to ~45 lines. The result display loop (lines 72-100) contains conditional formatting for created/updated/skipped/error states that is a natural extraction point.",
      "status": "pending",
      "priority": "low",
      "complexity": "low",
      "files_to_modify": [
        "internal/commands/sync.go"
      ],
      "source": "pilot-discovery"
    }
  ],
  "progress": {
    "total_tasks": 30,
    "completed_tasks": 7,
    "current_iteration": 33,
    "total_iterations_run": 33,
    "status": "in_progress"
  }
}
